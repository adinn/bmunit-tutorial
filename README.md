byteman-tutorial2a
==================

Instructions
============

Code used for the introductory tutorial for BMUnit which integrates Byteman into JUnit and TestNG

To build the app execute

    mvn install

To run the application execute

    mvn install
    java -classpath app/target/tutorial2a-app-1.0.0.jar org.my.app.WebWriter foo.html Andrew

You should find a newly written file called foo.html. Open it in a browser and
check that the title and body mention the name Andrew. Rerun with a different file or
user name and verify that the relevant details change.

To run the BMUnit tests execute

    mvn -P junit test

The first test should print the HTML header content to System.out.

    -------- testWriteHead ---------
    <HEAD>
      <TITLE>
      Welcome to the web page for Andrew
      </TITLE>
    </HEAD>
    
    -------- testWriteHead ---------

The validation rule found in junit/src/test/resources/check.btm checks
that the header test contains a <HEAD> and </HEAD> element. Note that
the debug call in the conditions always returns true but only prints
 output if debug or verbose trace is enabled (see follow ups below).

The second test should detect and handle a file not found failure. The Byteman
rule in the BMRule annotation is used to ensure that the file open throws an
exception.

    -------- handleFileNotFound ---------
    Unable to open file foo.html
    java.io.FileNotFoundException: Ha ha Byteman fooled you again!
    -------- handleFileNotFound ---------


The third test should detect and handle a write failure printing out the
following error message.

    -------- testWriteBody ---------
    Error writing body
    -------- testWriteBody ---------

n.b. if you see an exception here then the test has failed.

Follow-up Exercises
===================

Look at the rule in check.btm which validates the data generated by
makeHeader and makeBody.

Play with this rule to ensure it is actually being run (edit the]
condition to see if you can make it fire)

Try to add some of your own rules either to add more verification or just
to generate some trace output so you can see what is being called when
the test is run.

Modify the BMUnitConfig annotation on the test class by setting either of
the following attributes

    debug = true
    bmunitVerbose = true
    verbose = true

Look at the resulting debug and trace output generated by the BMUnit code
and the underlying Byteman agent code.

See what other BMUnitConfig attributes you can configure and identify what
they do.
